<!DOCTYPE html><html lang="en" class="dark"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#1E1E1E"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#1E1E1E"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="icon" type="image/png" href="/favicon/favicon.ico"/><link rel="apple-touch-icon" href="/favicon/favicon.ico"/><meta name="description" content="The Open Source Alternative to Firebase."/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@supabase"/><meta name="twitter:creator" content="@supabase"/><meta property="og:image:width" content="800"/><meta property="og:image:height" content="600"/><meta property="og:site_name" content="Supabase"/><title>Supabase Vault</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta property="og:title" content="Supabase Vault"/><meta property="og:description" content="Today we&#x27;re announcing Vault, a Postgres extension for managing secrets and encryption inside your database."/><meta property="og:url" content="https://supabase.com/blog/supabase-vault"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2022-08-19"/><meta property="article:author"/><meta property="article:tag" content="launch-week"/><meta property="og:image" content="https://supabase.com/images/blog/lw5-vault/supabase-vault.jpg"/><meta property="og:image:alt" content="Supabase Vault thumbnail"/><meta name="next-head-count" content="32"/><script async="" src="https://platform.twitter.com/widgets.js"></script><link rel="preload" href="/_next/static/css/07a2614af96d24f4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/07a2614af96d24f4.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-309fbebe2073f18c.js" defer=""></script><script src="/_next/static/chunks/framework-45ce3d09104a2cae.js" defer=""></script><script src="/_next/static/chunks/main-9453577d12e2bd52.js" defer=""></script><script src="/_next/static/chunks/pages/_app-785d79dfb8a76dfa.js" defer=""></script><script src="/_next/static/chunks/2edb282b-45c56c19221816df.js" defer=""></script><script src="/_next/static/chunks/6514-f656eb246dc4a97c.js" defer=""></script><script src="/_next/static/chunks/7005-fffa4d4bcb3673b5.js" defer=""></script><script src="/_next/static/chunks/6845-eae33a2eb3ea70e3.js" defer=""></script><script src="/_next/static/chunks/9001-28109a228ffc4448.js" defer=""></script><script src="/_next/static/chunks/9094-7bf7dde1e4665869.js" defer=""></script><script src="/_next/static/chunks/3808-0a8dd859cdc4ac01.js" defer=""></script><script src="/_next/static/chunks/4658-65fc7b3cb337ce1a.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-bfb73f1ff8645073.js" defer=""></script><script src="/_next/static/E3qX-eNJiFQeVyt1la8Oh/_buildManifest.js" defer=""></script><script src="/_next/static/E3qX-eNJiFQeVyt1la8Oh/_ssgManifest.js" defer=""></script><script src="/_next/static/E3qX-eNJiFQeVyt1la8Oh/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="sticky top-0 z-50"><div class="bg-scale-200 absolute top-0 h-full w-full opacity-80"></div><nav class="border-scale-400 border-b backdrop-blur-sm"><div class="relative mx-auto flex h-16 justify-between lg:container lg:px-16 xl:px-20"><div class="absolute inset-y-0 left-0 flex items-center px-2 lg:hidden"><button class="text-scale-900 focus:ring-brand-900 dark:bg-scale-200 dark:hover:bg-scale-300 inline-flex items-center justify-center rounded-md bg-gray-50 p-2 hover:bg-white focus:outline-none focus:ring-2 focus:ring-inset" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg><svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div><div class="flex flex-1 items-center justify-center sm:items-stretch lg:justify-between"><div class="flex items-center"><div class="flex flex-shrink-0 items-center"><a class="block h-6 w-auto" href="/"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27124%27%20height=%2724%27/%3e"/></span><img alt="Supabase Logo" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Supabase Logo" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fsupabase-logo-wordmark--light.ba3d6f54.png&amp;w=128&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fsupabase-logo-wordmark--light.ba3d6f54.png&amp;w=256&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fsupabase-logo-wordmark--light.ba3d6f54.png&amp;w=256&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></a></div><div class="hidden pl-4 sm:ml-6 sm:space-x-4 lg:flex"><div class="
        text-scale-1200 hover:text-brand-900
        inline-flex cursor-pointer items-center
        border-b-2
        border-transparent
        px-1
        text-sm font-medium
        transition-colors
                false"><span>Product</span><div class="text-scale-900 group-hover:text-scale-900 ml-2 flex h-5 w-5 items-center justify-center transition duration-150 ease-in-outfalse"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><polyline points="6 9 12 15 18 9"></polyline></svg></div></div><div class="
        text-scale-1200 hover:text-brand-900
        inline-flex cursor-pointer items-center
        border-b-2
        border-transparent
        px-1
        text-sm font-medium
        transition-colors
                false"><span>Developers</span><div class="text-scale-900 group-hover:text-scale-900 ml-2 flex h-5 w-5 items-center justify-center transition duration-150 ease-in-outfalse"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><polyline points="6 9 12 15 18 9"></polyline></svg></div></div><a class="
                        text-scale-1200 hover:text-brand-900 hover:border-brand-900 dark:text-dark-100 dark:hover:border-dark-100 inline-flex items-center
                        border-b-2 border-transparent p-5 px-1
                        text-sm font-medium
                      " href="/pricing">Pricing</a><a class="
                        text-scale-1200 hover:text-brand-900 hover:border-brand-900 dark:text-dark-100 dark:hover:border-dark-100 inline-flex items-center
                        border-b-2 border-transparent p-5 px-1
                        text-sm font-medium
                      " href="/blog">Blog</a></div></div><div class="flex items-center gap-2"><a href="https://github.com/supabase/supabase" target="_blank" class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1 group hidden lg:flex"><div class="text-brand-800 flex h-4 w-4 items-center justify-center"><div class="text-scale-900 flex h-3 w-3 items-center justify-center transition-all group-hover:h-4 group-hover:w-4 group-hover:text-yellow-900 group-focus:h-4 group-focus:w-4 group-focus:text-yellow-900"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg></div></div><span class="truncate">Star us on GitHub</span></a><a href="https://app.supabase.com/"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 bg-scale-100 hover:bg-scale-300 bordershadow-scale-600 hover:bordershadow-scale-700 dark:bordershadow-scale-700 hover:dark:bordershadow-scale-800 dark:bg-scale-500 dark:hover:bg-scale-600 focus-visible:outline-brand-600  shadow-sm text-xs px-2.5 py-1 hidden lg:block" type="button"><span class="truncate">Sign in</span></button></a><a href="https://app.supabase.com/"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   bg-brand-fixed-800 hover:bg-brand-fixed-900 text-white bordershadow-brand-fixed-800 hover:bordershadow-brand-fixed-1000 focus-visible:outline-brand-600  shadow-sm text-xs px-2.5 py-1 hidden text-white lg:block" type="button"><span class="truncate">Start your project</span></button></a></div></div></div></nav></div><div class="min-h-screen"><main><div class=" container mx-auto px-8 py-16 sm:px-16 xl:px-20 "><div class="grid grid-cols-12 gap-4"><div class="col-span-12 mb-2 lg:col-span-2"><p><a href="/blog" class="text-scale-900 hover:text-scale-1200 flex cursor-pointer items-center text-sm transition"><svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon " style="padding:0"><polyline points="15 18 9 12 15 6"></polyline></svg>Back</a></p></div><div class="col-span-12 lg:col-span-12 xl:col-span-10"><div class="mb-16 max-w-5xl space-y-8"><div class="space-y-4"><p class="text-brand-900">Blog post</p><h1 class="h1">Supabase Vault</h1><div class="text-scale-900 flex space-x-3 text-sm"><p>2022-08-19</p><p>•</p><p>7 minute read</p></div><div class="flex flex-col gap-3 pt-6 md:flex-row md:gap-0 lg:gap-3"><div class="mr-4 w-max"><a class="cursor-pointer" href="https://github.com/michelp"><div class="flex items-center gap-3"><div class="w-10"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;padding-top:100%"></span><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive" class="dark:border-dark rounded-full border" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img sizes="100vw" srcSet="/_next/image?url=https%3A%2F%2Fgithub.com%2Fmichelp.png&amp;w=640&amp;q=75 640w, /_next/image?url=https%3A%2F%2Fgithub.com%2Fmichelp.png&amp;w=750&amp;q=75 750w, /_next/image?url=https%3A%2F%2Fgithub.com%2Fmichelp.png&amp;w=828&amp;q=75 828w, /_next/image?url=https%3A%2F%2Fgithub.com%2Fmichelp.png&amp;w=1080&amp;q=75 1080w, /_next/image?url=https%3A%2F%2Fgithub.com%2Fmichelp.png&amp;w=1200&amp;q=75 1200w, /_next/image?url=https%3A%2F%2Fgithub.com%2Fmichelp.png&amp;w=1920&amp;q=75 1920w, /_next/image?url=https%3A%2F%2Fgithub.com%2Fmichelp.png&amp;w=2048&amp;q=75 2048w, /_next/image?url=https%3A%2F%2Fgithub.com%2Fmichelp.png&amp;w=3840&amp;q=75 3840w" src="/_next/image?url=https%3A%2F%2Fgithub.com%2Fmichelp.png&amp;w=3840&amp;q=75" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" class="dark:border-dark rounded-full border" loading="lazy"/></noscript></span></div><div class="flex flex-col"><span class="text-scale-1200 mb-0 text-sm">Michel Pelletier</span><span class="text-scale-900 mb-0 text-xs">Engineering</span></div></div></a></div></div></div></div><div class="grid grid-cols-12 lg:gap-16 xl:gap-8"><div class="col-span-12 lg:col-span-7 xl:col-span-7"><div class="relative mb-8 h-96 w-full overflow-auto rounded-lg border"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:absolute;top:0;left:0;bottom:0;right:0"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img sizes="100vw" srcSet="/_next/image?url=%2Fimages%2Fblog%2Flw5-vault%2Fsupabase-vault.jpg&amp;w=640&amp;q=75 640w, /_next/image?url=%2Fimages%2Fblog%2Flw5-vault%2Fsupabase-vault.jpg&amp;w=750&amp;q=75 750w, /_next/image?url=%2Fimages%2Fblog%2Flw5-vault%2Fsupabase-vault.jpg&amp;w=828&amp;q=75 828w, /_next/image?url=%2Fimages%2Fblog%2Flw5-vault%2Fsupabase-vault.jpg&amp;w=1080&amp;q=75 1080w, /_next/image?url=%2Fimages%2Fblog%2Flw5-vault%2Fsupabase-vault.jpg&amp;w=1200&amp;q=75 1200w, /_next/image?url=%2Fimages%2Fblog%2Flw5-vault%2Fsupabase-vault.jpg&amp;w=1920&amp;q=75 1920w, /_next/image?url=%2Fimages%2Fblog%2Flw5-vault%2Fsupabase-vault.jpg&amp;w=2048&amp;q=75 2048w, /_next/image?url=%2Fimages%2Fblog%2Flw5-vault%2Fsupabase-vault.jpg&amp;w=3840&amp;q=75 3840w" src="/_next/image?url=%2Fimages%2Fblog%2Flw5-vault%2Fsupabase-vault.jpg&amp;w=3840&amp;q=75" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div><article class="prose prose-docs"><p>Today we&#x27;re announcing <a href="https://github.com/supabase/vault">Supabase Vault</a>, a Postgres extension for managing secrets and encryption inside your database.
Vault is a thin usability-layer on top of <a href="https://github.com/michelp/pgsodium">pgsodium</a>.</p>
<p>Vault is not available on the Supabase platform yet. We&#x27;re finalizing usability and security testing.
This release is intended to gather user-feedback from our community and customers.</p>
<p>Soon, we&#x27;ll release a blog post that describes more about the technology behind Vault - <a href="https://doc.libsodium.org/">libsodium</a> and
<a href="https://doc.libsodium.org/">pgsodium</a>. For now, we will go through a quick example of storing a secret, like a service access token, into the Vault.</p>
<h2 id="background">Background</h2>
<p>Until now, the industry-standard for PostgreSQL encryption is a built-in extension called <a href="https://www.postgresql.org/docs/current/pgcrypto.html"><code>pgcrypto</code></a>.
Like most cloud providers, Supabase offers <code>pgcrypto</code> for developers to use in their applications. <code>pgcrypto</code> has been around for a long time,
and while it supports some basic encryption and decryption abilities, it lacks features like public key signing, key derivation APIs, streaming encryption,
and other modern features required by security-first applications.</p>
<h3 id="problems-with-raw-keys">Problems with raw keys</h3>
<p>Databases often store sensitive information, and they need tools that guarantee this data is stored and backed-up in an encrypted form.
A fundamental issue with <code>pgcrypto</code> is that it lacks the ability to derive keys from outside of SQL. Instead you must have the raw encryption key for the algorithm you wish to use:</p>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-sql" style="white-space:pre"><span style="color:#569cd6;font-weight:normal">create</span><span> extension pgcrypto;
</span>
<span></span><span style="color:#569cd6;font-weight:normal">create</span><span> </span><span style="color:#569cd6;font-weight:normal">table</span><span> users (
</span><span>  id serial </span><span style="color:#569cd6;font-weight:normal">primary</span><span> key,
</span><span>  email </span><span style="color:#3ECF8E;font-weight:normal">varchar</span><span> </span><span style="color:#569cd6;font-weight:normal">not</span><span> </span><span style="color:#569cd6;font-weight:normal">null</span><span> </span><span style="color:#569cd6;font-weight:normal">unique</span><span>
</span>);
<!-- -->
<span></span><span style="color:#569cd6;font-weight:normal">insert</span><span> </span><span style="color:#569cd6;font-weight:normal">into</span><span> users
</span>  (email)
<span></span><span style="color:#569cd6;font-weight:normal">values</span><span>
</span><span>  (pgp_sym_encrypt(</span><span style="color:#3ECF8E">&#x27;alice@supabase.io&#x27;</span><span>, </span><span style="color:#3ECF8E">&#x27;s3kr3t_k3y&#x27;</span><span>)),
</span><span>  (pgp_sym_encrypt(</span><span style="color:#3ECF8E">&#x27;bob@supabase.io&#x27;</span><span>, </span><span style="color:#3ECF8E">&#x27;s3kr3t_key&#x27;</span><span>));
</span></code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<p>pgcrypto works with <em>raw</em> keys. In order to encrypt the data with pgcrypto you must pass the key directly to the encryption function.
Leaking those raw keys is all too easy - logs, files, clients, tables, replication streams - you name it.
Wouldn&#x27;t it be great if you could encrypt data, but instead of specifying the raw key you reference it indirectly, like with a key ID?</p>
<h2 id="supabase-vault">Supabase Vault</h2>
<p>Supabase Vault allows you to store secrets without leaking any sensitive information.</p>
<p>The Vault is a good place to put things like API keys, access tokens, and other secrets from external services that you need to access within your database.
The core of the Supabase Vault is a table with some metadata and an encrypted text column where you can put your secrets and any metadata related to them.</p>
<p>We take the pain out of key management by pre-generating a unique, per-database key that is used by default - a “root” key - which is stored outside of the SQL language,
accessibly only internally in the Postgres server by the libsodium library. This root key is managed by the <a href="https://github.com/michelp/pgsodium">pgsodium</a> Postgres extension
when the server boots using <a href="https://github.com/michelp/pgsodium#server-key-management">Server Key Management.</a></p>
<p>pgsodium provides an Encryption and Key Derivation API based on the <a href="https://libsodium.gitbook.io/doc/">libsodium library</a> and can get it&#x27;s root key from a
variety of sources depending on how you configure it. Supabase generates and preserves your project&#x27;s root key behind the scenes, so you don&#x27;t have to worry about it.
If you install pgsodium locally the default is to generate a random root key from the <code>/dev/urandom</code> device which is then saved in a file in your Postgres data directory.</p>
<p>Installing the <code>vault</code> extension is the same as any other Postgres extension:</p>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-sql" style="white-space:pre"><span style="color:#569cd6;font-weight:normal">create</span><span> extension vault </span><span style="color:#569cd6;font-weight:normal">with</span><span> schema vault;
</span></code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<p>Once enabled, you can insert secrets into the <code>vault.secrets</code> table:</p>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-sql" style="white-space:pre"><span style="color:#569cd6;font-weight:normal">insert</span><span> </span><span style="color:#569cd6;font-weight:normal">into</span><span> vault.secrets
</span>  (secret, associated)
<span></span><span style="color:#569cd6;font-weight:normal">values</span><span>
</span><span>  (</span><span style="color:#3ECF8E">&#x27;s3kr3t_k3y&#x27;</span><span>, </span><span style="color:#3ECF8E">&#x27;This is the secret API service key.&#x27;</span><span>);
</span></code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<p>Now when you look in the <code>vault.secrets</code> table, the secret is encrypted:</p>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-sql" style="white-space:pre"><span style="color:#569cd6;font-weight:normal">select</span><span> </span><span class="hljs-operator">*</span><span> </span><span style="color:#569cd6;font-weight:normal">from</span><span> vault.secrets;
</span></code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-text" style="white-space:pre"><span>-[ RECORD 1 ]--------------------------------------------------------
</span>id         | f6a2fe0a-3471-4eea-a581-75c4d2be396b
<!-- -->secret     | /eT9bb96POTJ7L2gYrluTZ3r3pG5IMwPSQo6pQP0xdZTarpRrpWPXTWQ
<!-- -->key_id     | caabfc28-2ab3-48f5-8978-1b3d4b659911
<!-- -->associated | This is the secret API service key.
<!-- -->nonce      | \x77c7381c523630ba72f1f137626a9f9a
<!-- -->created_at | 2022-08-18 19:33:15.312651+00
</code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<p>Notice how the row has a <code>key_id</code> column. This is the <em>ID</em> of the internally derived key that is used to encrypt the secret, not the key itself.
The actual raw key is not available to you in SQL, it is managed entirely outside of the SQL language in the Postgres server.</p>
<p>At Supabase, we manage this key for your project automatically and generate a unique default Key ID for you in the <code>secrets</code> table.
For self-hosting, pgsodium <a href="https://github.com/michelp/pgsodium#server-key-management">supports a variety of ways</a> to place the root key into Postgres.</p>
<p>To see the decrypted data, there is a special view created called <code>vault.decrypted_secrets</code>:</p>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-sql" style="white-space:pre"><span style="color:#569cd6;font-weight:normal">select</span><span> </span><span class="hljs-operator">*</span><span> </span><span style="color:#569cd6;font-weight:normal">from</span><span> vault.decrypted_secrets;
</span></code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-text" style="white-space:pre"><span>-[ RECORD 1 ]----+---------------------------------------------------------
</span>id               | f6a2fe0a-3471-4eea-a581-75c4d2be396b
<!-- -->secret           | /eT9bb96POTJ7L2gYrluTZ3r3pG5IMwPSQo6pQP0xdZTarpRrpWPXTWQ
<!-- -->decrypted_secret | s3kr3t_k3y
<!-- -->key_id           | caabfc28-2ab3-48f5-8978-1b3d4b659911
<!-- -->associated       | This is the secret API service key.
<!-- -->nonce            | \x77c7381c523630ba72f1f137626a9f9a
<!-- -->created_at       | 2022-08-18 19:33:15.312651+00
</code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<p>Now you can see a new <code>decrypted_secret</code> column that contains the decrypted secret we originally inserted into the table.
This <code>vault.decrypted_secrets</code> view automatically decrypts rows in the <code>vault.secrets</code> table “on-the-fly” as you query them, but the secret is stored on disk in <em>encrypted</em> form.
If you take a backup, or pause your project, that data remains encrypted. We will keep your hidden root key safe in our backend systems for when you need to restore or un-pause your projects.</p>
<p>If you wish to use your own Key ID for different secrets, instead of the default Key ID we&#x27;ve generated, you can create one using the <code>pgsodium.create_key()</code> function:</p>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-sql" style="white-space:pre"><span style="color:#569cd6;font-weight:normal">select</span><span> </span><span class="hljs-operator">*</span><span> </span><span style="color:#569cd6;font-weight:normal">from</span><span> pgsodium.create_key(</span><span style="color:#3ECF8E">&#x27;This is a comment for the new key&#x27;</span><span>);
</span></code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-text" style="white-space:pre"><span>-[ RECORD 1 ]-------------------------------------
</span>id          | f9f176eb-7069-4743-9403-582c04354ffc
<!-- -->status      | valid
<!-- -->created     | 2022-08-18 22:31:50.331792
<!-- -->expires     |
<!-- -->key_type    | aead-det
<!-- -->key_id      | 2
<!-- -->key_context | \x7067736f6469756d
<!-- -->comment     | This is the comment for the new key
<!-- -->user_data   |
</code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<p>Now you can encrypt table secrets with this new key by inserting its ID explicitly:</p>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-sql" style="white-space:pre"><span style="color:#569cd6;font-weight:normal">insert</span><span> </span><span style="color:#569cd6;font-weight:normal">into</span><span> vault.secrets
</span>  (secret, associated, key_id)
<span></span><span style="color:#569cd6;font-weight:normal">values</span><span> (
</span><span>  </span><span style="color:#3ECF8E">&#x27;apikey_XaYrurzcquqhEdBjzfTzfwAZqpd&#x27;</span><span>,
</span><span>  </span><span style="color:#3ECF8E">&#x27;This is some different associated data.&#x27;</span><span>,
</span><span>  </span><span style="color:#3ECF8E">&#x27;f9f176eb-7069-4743-9403-582c04354ffc&#x27;</span><span>
</span>)
<span>returning </span><span class="hljs-operator">*</span><span>;
</span></code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<div class="not-prose dark overflow-hidden"><div class="relative"><pre class="rounded-t-lg rounded-b-lg" style="display:block;overflow-x:auto;padding:21px 24px;background:#181818;color:#ddd;font-size:0.875rem;line-height:1.4"><code class="language-text" style="white-space:pre"><span>-[ RECORD 1 ]------------------------------------------------------------
</span>id         | 9c58a0f3-aa40-4789-b683-6db48b241f9e
<!-- -->secret     | YWxuTnWdF55MuRrZ7xneBvaz2uH59U1dJV/7CCZjSn5B5jELOoy/csq8x/s=
<!-- -->key_id     | f9f176eb-7069-4743-9403-582c04354ffc
<!-- -->associated | This is some different associated data.
<!-- -->nonce      | \xd39808b07c9ae52c8f02c33a7f87595c
<!-- -->created_at | 2022-08-18 22:34:07.219941+00
</code></pre><div class="dark absolute right-2 top-2"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   text-scale-1200 hover:bg-scale-500 shadow-none focus-visible:outline-scale-700  text-xs px-2.5 py-1" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon "><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div></div></div>
<p>The type of encryption used by the Vault is called <a href="https://en.wikipedia.org/wiki/Authenticated_encryption">Authenticated Encryption with Associated Data</a>.
The data you insert into the <code>associated</code> column, which is up to you, is combined with the encrypted text when libsodium creates the authentication signature for the secret.
This means that when you read the secret, you know that the associated data is also authentic. The associated data could be an account ID or some
information that ties your system to the secret. And as always, you can refer to rows in the secrets table by their primary key UUID.</p>
<p>If you only want to store secrets that you know are encrypted on disk and in backups, then all you need to know is shown above. Just insert secrets into the table,
optionally creating new keys, and select them from the view when you want to use them.</p>
<h2 id="going-beyond-the-vault">Going Beyond the Vault</h2>
<p>The Vault is good for a reasonable amount of secure data, like API keys, access tokens, or environment variables.
But if you have a lot more sensitive information, like personally Identifiable Information (PII),
you may want to break them out into side-tables using pgsodium&#x27;s
<a href="https://github.com/michelp/pgsodium#transparent-column-encryption">Transparent Column Encryption</a> which we will describe soon in a follow-up blog post. Stay tuned!</p></article><div class="py-16"><div class="text-scale-900 dark:text-scale-1000 text-sm">Share this article</div><div class="mt-4 flex items-center space-x-4"><a target="_blank" class="text-scale-900 hover:text-scale-1200" href="https://twitter.com/share?text=Supabase Vault&amp;url=https://supabase.com/blog/supabase-vault"><svg height="26" width="26" viewBox="-89 -46.8 644 446.8" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="m154.729 400c185.669 0 287.205-153.876 287.205-287.312 0-4.37-.089-8.72-.286-13.052a205.304 205.304 0 0 0 50.352-52.29c-18.087 8.044-37.55 13.458-57.968 15.899 20.841-12.501 36.84-32.278 44.389-55.852a202.42 202.42 0 0 1 -64.098 24.511c-18.42-19.628-44.644-31.904-73.682-31.904-55.744 0-100.948 45.222-100.948 100.965 0 7.925.887 15.631 2.619 23.025-83.895-4.223-158.287-44.405-208.074-105.504a100.739 100.739 0 0 0 -13.668 50.754c0 35.034 17.82 65.961 44.92 84.055a100.172 100.172 0 0 1 -45.716-12.63c-.015.424-.015.837-.015 1.29 0 48.903 34.794 89.734 80.982 98.986a101.036 101.036 0 0 1 -26.617 3.553c-6.493 0-12.821-.639-18.971-1.82 12.851 40.122 50.115 69.319 94.296 70.135-34.549 27.089-78.07 43.224-125.371 43.224a204.9 204.9 0 0 1 -24.078-1.399c44.674 28.645 97.72 45.359 154.734 45.359" fill-rule="nonzero"></path></svg></a><a target="_blank" class="text-scale-900 hover:text-scale-1200" href="https://www.linkedin.com/shareArticle?url=https://supabase.com/blog/supabase-vault&amp;title=Supabase Vault"><svg width="20" height="20" viewBox="0 5 1036 990" xmlns="http://www.w3.org/2000/svg" fill="currentColor"><path d="M0 120c0-33.334 11.667-60.834 35-82.5C58.333 15.833 88.667 5 126 5c36.667 0 66.333 10.666 89 32 23.333 22 35 50.666 35 86 0 32-11.333 58.666-34 80-23.333 22-54 33-92 33h-1c-36.667 0-66.333-11-89-33S0 153.333 0 120zm13 875V327h222v668H13zm345 0h222V622c0-23.334 2.667-41.334 8-54 9.333-22.667 23.5-41.834 42.5-57.5 19-15.667 42.833-23.5 71.5-23.5 74.667 0 112 50.333 112 151v357h222V612c0-98.667-23.333-173.5-70-224.5S857.667 311 781 311c-86 0-153 37-201 111v2h-1l1-2v-95H358c1.333 21.333 2 87.666 2 199 0 111.333-.667 267.666-2 469z"></path></svg></a></div></div><div class="grid gap-8 py-8 lg:grid-cols-1"><div><div><div class="border-scale-500 hover:bg-scale-100 dark:hover:bg-scale-300 cursor-pointer rounded border p-6 transition"><div class="space-y-4"><div><p class="text-scale-900 text-sm">Last post</p></div><div><h4 class="text-scale-1200 text-lg">Building a Realtime Trello Board with Supabase and Angular</h4><p class="small">24 August 2022</p></div></div></div></div></div><div><div class="text-right"><div class="border-scale-500 hover:bg-scale-100 dark:hover:bg-scale-300 cursor-pointer rounded border p-6 transition"><div class="space-y-4"><div><p class="text-scale-900 text-sm">Next post</p></div><div><h4 class="text-scale-1200 text-lg">PostgREST v10: EXPLAIN and Improved Relationship Detection</h4><p class="small">19 August 2022</p></div></div></div></div></div></div></div><div class="col-span-12 space-y-8 lg:col-span-5 xl:col-span-3 xl:col-start-9"><div class="space-y-8 lg:sticky lg:top-16 lg:mb-16"><div class="hidden lg:block"><div class="space-y-8 py-8 lg:py-0"><div><div class="space-x-2"><a href="/blog/tags/launch-week"><span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-opacity-10 bg-brand-200 text-brand-1100 border border-brand-700">launch-week</span></a></div></div><div><div><p class="text-scale-1200 mb-4">On this page</p><div class="prose-toc"><ul>
<li><a href="#background">Background</a></li>
<li><a href="#supabase-vault">Supabase Vault</a></li>
<li><a href="#going-beyond-the-vault">Going Beyond the Vault</a></li>
</ul></div></div></div></div></div><div><div class="mb-4"><p class="text-scale-1200 text-sm">Related articles</p></div><div class="space-y-3"><div><p class="cursor-pointer"><div class="flex gap-2"><div class="text-scale-900"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon " style="min-width:1.2rem"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg></div><span class="text-scale-1100 hover:text-gray-1200 text-sm">What is PostgreSQL commitfest and how to contribute</span></div></p><div role="separator"></div></div><div><p class="cursor-pointer"><div class="flex gap-2"><div class="text-scale-900"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon " style="min-width:1.2rem"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg></div><span class="text-scale-1100 hover:text-gray-1200 text-sm">supabase-flutter v1 Released</span></div></p><div role="separator"></div></div><div><p class="cursor-pointer"><div class="flex gap-2"><div class="text-scale-900"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon " style="min-width:1.2rem"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg></div><span class="text-scale-1100 hover:text-gray-1200 text-sm">supabase-js v2 Released</span></div></p><div role="separator"></div></div><div><p class="cursor-pointer"><div class="flex gap-2"><div class="text-scale-900"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon " style="min-width:1.2rem"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg></div><span class="text-scale-1100 hover:text-gray-1200 text-sm">Postgres Full Text Search vs the rest</span></div></p><div role="separator"></div></div><div><p class="cursor-pointer"><div class="flex gap-2"><div class="text-scale-900"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon " style="min-width:1.2rem"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg></div><span class="text-scale-1100 hover:text-gray-1200 text-sm">Supabase Beta September 2022</span></div></p><div role="separator"></div></div><div class="mt-2"><a class="text-scale-1100 hover:text-scale-1200 cursor-pointer text-sm" href="/blog">View all posts</a></div></div></div></div></div></div></div></div></div><div class="
        bg-dark-800 grid grid-cols-12 items-center gap-4 border-t py-32 text-center dark:border-gray-600
         px-16
      "><div class="col-span-12"><h2 class="h2"><span class="text-scale-900">Build in a weekend,</span><span class="text-scale-1200 dark:text-white"> scale to millions</span></h2></div><div class="col-span-12 mt-4"><a href="https://app.supabase.com/"><button class=" relative cursor-pointer inline-flex items-center space-x-2 text-center font-regular transition ease-out duration-200 rounded outline-none transition-all outline-0 focus-visible:outline-4 focus-visible:outline-offset-1   bg-brand-fixed-800 hover:bg-brand-fixed-900 text-white bordershadow-brand-fixed-800 hover:bordershadow-brand-fixed-1000 focus-visible:outline-brand-600  shadow-sm text-sm px-4 py-2 text-white" type="button"><span class="truncate">Start your project</span></button></a></div></div></main></div><footer class="border-scale-500 dark:border-scale-600 border-t" aria-labelledby="footerHeading"><h2 id="footerHeading" class="sr-only">Footer</h2><div class="sm:py-18 container relative mx-auto px-6 py-16 md:py-24 lg:px-16 lg:py-24 xl:px-20"><div class="xl:grid xl:grid-cols-3 xl:gap-8"><div class="space-y-8 xl:col-span-1"><a class="w-40" href="/"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27160%27%20height=%2730%27/%3e"/></span><img alt="Supabase" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="Supabase" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fsupabase-logo-wordmark--light.ba3d6f54.png&amp;w=256&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fsupabase-logo-wordmark--light.ba3d6f54.png&amp;w=384&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fsupabase-logo-wordmark--light.ba3d6f54.png&amp;w=384&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></a><div class="flex space-x-5"><a href="https://twitter.com/supabase" class="text-scale-900 hover:text-scale-1200 transition"><span class="sr-only">Twitter</span><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg></a><a href="https://github.com/supabase" class="text-scale-900 hover:text-scale-1200 transition"><span class="sr-only">GitHub</span><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg></a><a href="https://discord.supabase.com/" class="text-scale-900 hover:text-scale-1200 transition"><span class="sr-only">Discord</span><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 71 55" aria-hidden="true"><path fill-rule="evenodd" d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z" clip-rule="evenodd"></path></svg></a><a href="https://youtube.com/c/supabase" class="text-scale-900 hover:text-scale-1200 transition"><span class="sr-only">Youtube</span><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 576 512" aria-hidden="true"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a></div></div><div class="mt-12 grid grid-cols-1 gap-8 xl:col-span-2 xl:mt-0"><div class="grid grid-cols-2 gap-8 md:grid-cols-4"><div><h6 class="text-scale-1200 overwrite text-base">Product</h6><ul class="mt-4 space-y-2"><li><a href="/database" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Database</a></li><li><a href="/auth" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Auth</a></li><li><a href="/storage" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Storage</a></li><li><a href="/edge-functions" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Functions</a></li><li><a href="/pricing" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Pricing</a></li><li><a href="/beta" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Beta</a></li></ul></div><div><h6 class="text-scale-1200 overwrite text-base">Resources</h6><ul class="mt-4 space-y-2"><li><a href="/support" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Support</a></li><li><a href="/brand-assets" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Brand Assets / Logos</a></li><li><a href="/partners/integrations" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Integrations</a></li><li><a href="/partners/experts" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Experts</a></li><li><a href="https://status.supabase.com/" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">System Status</a></li><li><a href="/docs/company/terms" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Terms of service</a></li><li><a href="/docs/company/privacy" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Privacy Policy</a></li><li><a href="/legal/dpa" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">DPA</a></li><li><a href="/legal/soc2" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">SOC2</a></li></ul></div><div><h6 class="text-scale-1200 overwrite text-base">Developers</h6><ul class="mt-4 space-y-2"><li><a href="/docs" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Documentation</a></li><li><a href="/docs/guides/api" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">API Reference</a></li><li><a href="/docs/" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Guides</a></li><li><a href="/changelog" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Changelog</a></li></ul></div><div><h6 class="text-scale-1200 overwrite text-base">Company</h6><ul class="mt-4 space-y-2"><li><a href="/blog" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Blog</a></li><li><a href="/docs/oss" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Open Source</a></li><li><a href="https://about.supabase.com/careers" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Careers</a></li><li><a href="/company" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Company</a></li><li><a href="/humans.txt" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Humans.txt</a></li><li><a href="/lawyers.txt" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Lawyers.txt</a></li><li><a href="/.well-known/security.txt" class="text-sm transition-colors text-scale-1100 hover:text-scale-1200  ">Security.txt</a></li></ul></div></div></div></div><div class="border-scale-500 dark:border-scale-600 mt-32 flex justify-between border-t pt-8"><small class="small">© Supabase Inc</small><div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon text-scale-900"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg><button type="button" aria-pressed="false" class="
                relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent
                transition-colors duration-200 ease-in-out focus:outline-none bg-scale-900 mx-5
              "><span class="sr-only">Toggle Themes</span><span aria-hidden="true" class="
                  translate-x-0 dark:bg-scale-300 inline-block h-5 w-5
                  transform rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out
                "></span></button><svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sbui-icon text-scale-900"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></div></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"prevPost":{"slug":"building-a-realtime-trello-board-with-supabase-and-angular","title":"Building a Realtime Trello Board with Supabase and Angular","description":"Go beyond the hello world example with this real world project.","author":"simon_grimm","image":"simon-grimm-angular-realtime/angular-supabase.png","thumb":"simon-grimm-angular-realtime/angular-supabase.png","tags":["angular","realtime","community"],"date":"24 August 2022","toc_depth":2,"readingTime":"47 minute read","url":"/blog/building-a-realtime-trello-board-with-supabase-and-angular","path":"/blog/building-a-realtime-trello-board-with-supabase-and-angular"},"nextPost":{"slug":"postgrest-v10","title":"PostgREST v10: EXPLAIN and Improved Relationship Detection","description":"Today, PostgREST 10 was released. Let's take a look at some of the new features that go hand in hand with supabase-js v2.","author":"steve_chavez","image":"lw5/postgrest-v10.png","thumb":"lw5/postgrest-v10.png","tags":["launch-week"],"date":"19 August 2022","toc_depth":3,"readingTime":"8 minute read","url":"/blog/postgrest-v10","path":"/blog/postgrest-v10"},"relatedPosts":[{"slug":"postgresql-commitfest","title":"What is PostgreSQL commitfest and how to contribute","description":"A time-tested method for contributing to the core Postgres code","author":"pavel","image":"what-is-postgres-commitfest/what-is-postgres-commitfest.jpg","thumb":"what-is-postgres-commitfest/what-is-postgres-commitfest.jpg","tags":["postgres"],"date":"27 October 2022","toc_depth":3,"readingTime":"11 minute read","url":"/blog/postgresql-commitfest","path":"/blog/postgresql-commitfest"},{"slug":"supabase-flutter-sdk-v1-released","title":"supabase-flutter v1 Released","description":"We've released supabase-flutter v1. More intuitive way of accessing Supabase from your Flutter application.","author":"tyler_shukert","image":"flutter-v1-release/flutter_v1_official_release.jpeg","thumb":"flutter-v1-release/flutter_v1_official_release.jpeg","tags":["flutter","mobile"],"date":"21 October 2022","toc_depth":3,"readingTime":"3 minute read","url":"/blog/supabase-flutter-sdk-v1-released","path":"/blog/supabase-flutter-sdk-v1-released"},{"slug":"supabase-js-v2-released","title":"supabase-js v2 Released","description":"We've released supabase-js v2. Updated examples, quickstarts, and an improved experience.","author":"thor_schaeff","image":"supabase-js-v2-release/supabase-js.jpg","thumb":"supabase-js-v2-release/supabase-js.jpg","tags":["launch-week"],"date":"20 October 2022","toc_depth":3,"readingTime":"2 minute read","url":"/blog/supabase-js-v2-released","path":"/blog/supabase-js-v2-released"},{"slug":"postgres-full-text-search-vs-the-rest","title":"Postgres Full Text Search vs the rest","description":"Comparing one of the most popular Postgres features against alternatives","author":"victor","image":"postgres-fts-vs-the-rest/postgres-full-text-search.jpg","thumb":"postgres-fts-vs-the-rest/postgres-full-text-search.jpg","tags":["postgres"],"date":"14 October 2022","toc_depth":3,"readingTime":"14 minute read","url":"/blog/postgres-full-text-search-vs-the-rest","path":"/blog/postgres-full-text-search-vs-the-rest"},{"slug":"supabase-beta-update-september-2022","title":"Supabase Beta September 2022","description":"We were too focused on clearing out the backlog so we didn't ship anything new last month... or did we?!","author":"ant_wilson","image":"2022-september/monthly-update-september-2022.jpg","thumb":"2022-september/monthly-update-september-2022.jpg","tags":["release-notes"],"date":"5 October 2022","toc_depth":3,"readingTime":"4 minute read","url":"/blog/supabase-beta-update-september-2022","path":"/blog/supabase-beta-update-september-2022"}],"blog":{"slug":"supabase-vault","content":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    a: \"a\",\n    h2: \"h2\",\n    code: \"code\",\n    h3: \"h3\",\n    pre: \"pre\",\n    em: \"em\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"Today we're announcing \", _jsx(_components.a, {\n        href: \"https://github.com/supabase/vault\",\n        children: \"Supabase Vault\"\n      }), \", a Postgres extension for managing secrets and encryption inside your database.\\nVault is a thin usability-layer on top of \", _jsx(_components.a, {\n        href: \"https://github.com/michelp/pgsodium\",\n        children: \"pgsodium\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Vault is not available on the Supabase platform yet. We're finalizing usability and security testing.\\nThis release is intended to gather user-feedback from our community and customers.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Soon, we'll release a blog post that describes more about the technology behind Vault - \", _jsx(_components.a, {\n        href: \"https://doc.libsodium.org/\",\n        children: \"libsodium\"\n      }), \" and\\n\", _jsx(_components.a, {\n        href: \"https://doc.libsodium.org/\",\n        children: \"pgsodium\"\n      }), \". For now, we will go through a quick example of storing a secret, like a service access token, into the Vault.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"background\",\n      children: \"Background\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Until now, the industry-standard for PostgreSQL encryption is a built-in extension called \", _jsx(_components.a, {\n        href: \"https://www.postgresql.org/docs/current/pgcrypto.html\",\n        children: _jsx(_components.code, {\n          children: \"pgcrypto\"\n        })\n      }), \".\\nLike most cloud providers, Supabase offers \", _jsx(_components.code, {\n        children: \"pgcrypto\"\n      }), \" for developers to use in their applications. \", _jsx(_components.code, {\n        children: \"pgcrypto\"\n      }), \" has been around for a long time,\\nand while it supports some basic encryption and decryption abilities, it lacks features like public key signing, key derivation APIs, streaming encryption,\\nand other modern features required by security-first applications.\"]\n    }), \"\\n\", _jsx(_components.h3, {\n      id: \"problems-with-raw-keys\",\n      children: \"Problems with raw keys\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Databases often store sensitive information, and they need tools that guarantee this data is stored and backed-up in an encrypted form.\\nA fundamental issue with \", _jsx(_components.code, {\n        children: \"pgcrypto\"\n      }), \" is that it lacks the ability to derive keys from outside of SQL. Instead you must have the raw encryption key for the algorithm you wish to use:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-sql\",\n        children: \"create extension pgcrypto;\\n\\ncreate table users (\\n  id serial primary key,\\n  email varchar not null unique\\n);\\n\\ninsert into users\\n  (email)\\nvalues\\n  (pgp_sym_encrypt('alice@supabase.io', 's3kr3t_k3y')),\\n  (pgp_sym_encrypt('bob@supabase.io', 's3kr3t_key'));\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"pgcrypto works with \", _jsx(_components.em, {\n        children: \"raw\"\n      }), \" keys. In order to encrypt the data with pgcrypto you must pass the key directly to the encryption function.\\nLeaking those raw keys is all too easy - logs, files, clients, tables, replication streams - you name it.\\nWouldn't it be great if you could encrypt data, but instead of specifying the raw key you reference it indirectly, like with a key ID?\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"supabase-vault\",\n      children: \"Supabase Vault\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Supabase Vault allows you to store secrets without leaking any sensitive information.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The Vault is a good place to put things like API keys, access tokens, and other secrets from external services that you need to access within your database.\\nThe core of the Supabase Vault is a table with some metadata and an encrypted text column where you can put your secrets and any metadata related to them.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"We take the pain out of key management by pre-generating a unique, per-database key that is used by default - a “root” key - which is stored outside of the SQL language,\\naccessibly only internally in the Postgres server by the libsodium library. This root key is managed by the \", _jsx(_components.a, {\n        href: \"https://github.com/michelp/pgsodium\",\n        children: \"pgsodium\"\n      }), \" Postgres extension\\nwhen the server boots using \", _jsx(_components.a, {\n        href: \"https://github.com/michelp/pgsodium#server-key-management\",\n        children: \"Server Key Management.\"\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"pgsodium provides an Encryption and Key Derivation API based on the \", _jsx(_components.a, {\n        href: \"https://libsodium.gitbook.io/doc/\",\n        children: \"libsodium library\"\n      }), \" and can get it's root key from a\\nvariety of sources depending on how you configure it. Supabase generates and preserves your project's root key behind the scenes, so you don't have to worry about it.\\nIf you install pgsodium locally the default is to generate a random root key from the \", _jsx(_components.code, {\n        children: \"/dev/urandom\"\n      }), \" device which is then saved in a file in your Postgres data directory.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Installing the \", _jsx(_components.code, {\n        children: \"vault\"\n      }), \" extension is the same as any other Postgres extension:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-sql\",\n        children: \"create extension vault with schema vault;\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Once enabled, you can insert secrets into the \", _jsx(_components.code, {\n        children: \"vault.secrets\"\n      }), \" table:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-sql\",\n        children: \"insert into vault.secrets\\n  (secret, associated)\\nvalues\\n  ('s3kr3t_k3y', 'This is the secret API service key.');\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now when you look in the \", _jsx(_components.code, {\n        children: \"vault.secrets\"\n      }), \" table, the secret is encrypted:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-sql\",\n        children: \"select * from vault.secrets;\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"-[ RECORD 1 ]--------------------------------------------------------\\nid         | f6a2fe0a-3471-4eea-a581-75c4d2be396b\\nsecret     | /eT9bb96POTJ7L2gYrluTZ3r3pG5IMwPSQo6pQP0xdZTarpRrpWPXTWQ\\nkey_id     | caabfc28-2ab3-48f5-8978-1b3d4b659911\\nassociated | This is the secret API service key.\\nnonce      | \\\\x77c7381c523630ba72f1f137626a9f9a\\ncreated_at | 2022-08-18 19:33:15.312651+00\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Notice how the row has a \", _jsx(_components.code, {\n        children: \"key_id\"\n      }), \" column. This is the \", _jsx(_components.em, {\n        children: \"ID\"\n      }), \" of the internally derived key that is used to encrypt the secret, not the key itself.\\nThe actual raw key is not available to you in SQL, it is managed entirely outside of the SQL language in the Postgres server.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"At Supabase, we manage this key for your project automatically and generate a unique default Key ID for you in the \", _jsx(_components.code, {\n        children: \"secrets\"\n      }), \" table.\\nFor self-hosting, pgsodium \", _jsx(_components.a, {\n        href: \"https://github.com/michelp/pgsodium#server-key-management\",\n        children: \"supports a variety of ways\"\n      }), \" to place the root key into Postgres.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To see the decrypted data, there is a special view created called \", _jsx(_components.code, {\n        children: \"vault.decrypted_secrets\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-sql\",\n        children: \"select * from vault.decrypted_secrets;\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"-[ RECORD 1 ]----+---------------------------------------------------------\\nid               | f6a2fe0a-3471-4eea-a581-75c4d2be396b\\nsecret           | /eT9bb96POTJ7L2gYrluTZ3r3pG5IMwPSQo6pQP0xdZTarpRrpWPXTWQ\\ndecrypted_secret | s3kr3t_k3y\\nkey_id           | caabfc28-2ab3-48f5-8978-1b3d4b659911\\nassociated       | This is the secret API service key.\\nnonce            | \\\\x77c7381c523630ba72f1f137626a9f9a\\ncreated_at       | 2022-08-18 19:33:15.312651+00\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Now you can see a new \", _jsx(_components.code, {\n        children: \"decrypted_secret\"\n      }), \" column that contains the decrypted secret we originally inserted into the table.\\nThis \", _jsx(_components.code, {\n        children: \"vault.decrypted_secrets\"\n      }), \" view automatically decrypts rows in the \", _jsx(_components.code, {\n        children: \"vault.secrets\"\n      }), \" table “on-the-fly” as you query them, but the secret is stored on disk in \", _jsx(_components.em, {\n        children: \"encrypted\"\n      }), \" form.\\nIf you take a backup, or pause your project, that data remains encrypted. We will keep your hidden root key safe in our backend systems for when you need to restore or un-pause your projects.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"If you wish to use your own Key ID for different secrets, instead of the default Key ID we've generated, you can create one using the \", _jsx(_components.code, {\n        children: \"pgsodium.create_key()\"\n      }), \" function:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-sql\",\n        children: \"select * from pgsodium.create_key('This is a comment for the new key');\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"-[ RECORD 1 ]-------------------------------------\\nid          | f9f176eb-7069-4743-9403-582c04354ffc\\nstatus      | valid\\ncreated     | 2022-08-18 22:31:50.331792\\nexpires     |\\nkey_type    | aead-det\\nkey_id      | 2\\nkey_context | \\\\x7067736f6469756d\\ncomment     | This is the comment for the new key\\nuser_data   |\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now you can encrypt table secrets with this new key by inserting its ID explicitly:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-sql\",\n        children: \"insert into vault.secrets\\n  (secret, associated, key_id)\\nvalues (\\n  'apikey_XaYrurzcquqhEdBjzfTzfwAZqpd',\\n  'This is some different associated data.',\\n  'f9f176eb-7069-4743-9403-582c04354ffc'\\n)\\nreturning *;\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-text\",\n        children: \"-[ RECORD 1 ]------------------------------------------------------------\\nid         | 9c58a0f3-aa40-4789-b683-6db48b241f9e\\nsecret     | YWxuTnWdF55MuRrZ7xneBvaz2uH59U1dJV/7CCZjSn5B5jELOoy/csq8x/s=\\nkey_id     | f9f176eb-7069-4743-9403-582c04354ffc\\nassociated | This is some different associated data.\\nnonce      | \\\\xd39808b07c9ae52c8f02c33a7f87595c\\ncreated_at | 2022-08-18 22:34:07.219941+00\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The type of encryption used by the Vault is called \", _jsx(_components.a, {\n        href: \"https://en.wikipedia.org/wiki/Authenticated_encryption\",\n        children: \"Authenticated Encryption with Associated Data\"\n      }), \".\\nThe data you insert into the \", _jsx(_components.code, {\n        children: \"associated\"\n      }), \" column, which is up to you, is combined with the encrypted text when libsodium creates the authentication signature for the secret.\\nThis means that when you read the secret, you know that the associated data is also authentic. The associated data could be an account ID or some\\ninformation that ties your system to the secret. And as always, you can refer to rows in the secrets table by their primary key UUID.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"If you only want to store secrets that you know are encrypted on disk and in backups, then all you need to know is shown above. Just insert secrets into the table,\\noptionally creating new keys, and select them from the view when you want to use them.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      id: \"going-beyond-the-vault\",\n      children: \"Going Beyond the Vault\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The Vault is good for a reasonable amount of secure data, like API keys, access tokens, or environment variables.\\nBut if you have a lot more sensitive information, like personally Identifiable Information (PII),\\nyou may want to break them out into side-tables using pgsodium's\\n\", _jsx(_components.a, {\n        href: \"https://github.com/michelp/pgsodium#transparent-column-encryption\",\n        children: \"Transparent Column Encryption\"\n      }), \" which we will describe soon in a follow-up blog post. Stay tuned!\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}},"source":"\nToday we're announcing [Supabase Vault](https://github.com/supabase/vault), a Postgres extension for managing secrets and encryption inside your database.\nVault is a thin usability-layer on top of [pgsodium](https://github.com/michelp/pgsodium).\n\nVault is not available on the Supabase platform yet. We're finalizing usability and security testing.\nThis release is intended to gather user-feedback from our community and customers.\n\nSoon, we'll release a blog post that describes more about the technology behind Vault - [libsodium](https://doc.libsodium.org/) and\n[pgsodium](https://doc.libsodium.org/). For now, we will go through a quick example of storing a secret, like a service access token, into the Vault.\n\n## Background\n\nUntil now, the industry-standard for PostgreSQL encryption is a built-in extension called [`pgcrypto`](https://www.postgresql.org/docs/current/pgcrypto.html).\nLike most cloud providers, Supabase offers `pgcrypto` for developers to use in their applications. `pgcrypto` has been around for a long time,\nand while it supports some basic encryption and decryption abilities, it lacks features like public key signing, key derivation APIs, streaming encryption,\nand other modern features required by security-first applications.\n\n### Problems with raw keys\n\nDatabases often store sensitive information, and they need tools that guarantee this data is stored and backed-up in an encrypted form.\nA fundamental issue with `pgcrypto` is that it lacks the ability to derive keys from outside of SQL. Instead you must have the raw encryption key for the algorithm you wish to use:\n\n```sql\ncreate extension pgcrypto;\n\ncreate table users (\n  id serial primary key,\n  email varchar not null unique\n);\n\ninsert into users\n  (email)\nvalues\n  (pgp_sym_encrypt('alice@supabase.io', 's3kr3t_k3y')),\n  (pgp_sym_encrypt('bob@supabase.io', 's3kr3t_key'));\n```\n\npgcrypto works with _raw_ keys. In order to encrypt the data with pgcrypto you must pass the key directly to the encryption function.\nLeaking those raw keys is all too easy - logs, files, clients, tables, replication streams - you name it.\nWouldn't it be great if you could encrypt data, but instead of specifying the raw key you reference it indirectly, like with a key ID?\n\n## Supabase Vault\n\nSupabase Vault allows you to store secrets without leaking any sensitive information.\n\nThe Vault is a good place to put things like API keys, access tokens, and other secrets from external services that you need to access within your database.\nThe core of the Supabase Vault is a table with some metadata and an encrypted text column where you can put your secrets and any metadata related to them.\n\nWe take the pain out of key management by pre-generating a unique, per-database key that is used by default - a “root” key - which is stored outside of the SQL language,\naccessibly only internally in the Postgres server by the libsodium library. This root key is managed by the [pgsodium](https://github.com/michelp/pgsodium) Postgres extension\nwhen the server boots using [Server Key Management.](https://github.com/michelp/pgsodium#server-key-management)\n\npgsodium provides an Encryption and Key Derivation API based on the [libsodium library](https://libsodium.gitbook.io/doc/) and can get it's root key from a\nvariety of sources depending on how you configure it. Supabase generates and preserves your project's root key behind the scenes, so you don't have to worry about it.\nIf you install pgsodium locally the default is to generate a random root key from the `/dev/urandom` device which is then saved in a file in your Postgres data directory.\n\nInstalling the `vault` extension is the same as any other Postgres extension:\n\n```sql\ncreate extension vault with schema vault;\n```\n\nOnce enabled, you can insert secrets into the `vault.secrets` table:\n\n```sql\ninsert into vault.secrets\n  (secret, associated)\nvalues\n  ('s3kr3t_k3y', 'This is the secret API service key.');\n```\n\nNow when you look in the `vault.secrets` table, the secret is encrypted:\n\n```sql\nselect * from vault.secrets;\n```\n\n```text hideCopy\n-[ RECORD 1 ]--------------------------------------------------------\nid         | f6a2fe0a-3471-4eea-a581-75c4d2be396b\nsecret     | /eT9bb96POTJ7L2gYrluTZ3r3pG5IMwPSQo6pQP0xdZTarpRrpWPXTWQ\nkey_id     | caabfc28-2ab3-48f5-8978-1b3d4b659911\nassociated | This is the secret API service key.\nnonce      | \\x77c7381c523630ba72f1f137626a9f9a\ncreated_at | 2022-08-18 19:33:15.312651+00\n```\n\nNotice how the row has a `key_id` column. This is the _ID_ of the internally derived key that is used to encrypt the secret, not the key itself.\nThe actual raw key is not available to you in SQL, it is managed entirely outside of the SQL language in the Postgres server.\n\nAt Supabase, we manage this key for your project automatically and generate a unique default Key ID for you in the `secrets` table.\nFor self-hosting, pgsodium [supports a variety of ways](https://github.com/michelp/pgsodium#server-key-management) to place the root key into Postgres.\n\nTo see the decrypted data, there is a special view created called `vault.decrypted_secrets`:\n\n```sql\nselect * from vault.decrypted_secrets;\n```\n\n```text hideCopy\n-[ RECORD 1 ]----+---------------------------------------------------------\nid               | f6a2fe0a-3471-4eea-a581-75c4d2be396b\nsecret           | /eT9bb96POTJ7L2gYrluTZ3r3pG5IMwPSQo6pQP0xdZTarpRrpWPXTWQ\ndecrypted_secret | s3kr3t_k3y\nkey_id           | caabfc28-2ab3-48f5-8978-1b3d4b659911\nassociated       | This is the secret API service key.\nnonce            | \\x77c7381c523630ba72f1f137626a9f9a\ncreated_at       | 2022-08-18 19:33:15.312651+00\n```\n\nNow you can see a new `decrypted_secret` column that contains the decrypted secret we originally inserted into the table.\nThis `vault.decrypted_secrets` view automatically decrypts rows in the `vault.secrets` table “on-the-fly” as you query them, but the secret is stored on disk in _encrypted_ form.\nIf you take a backup, or pause your project, that data remains encrypted. We will keep your hidden root key safe in our backend systems for when you need to restore or un-pause your projects.\n\nIf you wish to use your own Key ID for different secrets, instead of the default Key ID we've generated, you can create one using the `pgsodium.create_key()` function:\n\n```sql\nselect * from pgsodium.create_key('This is a comment for the new key');\n```\n\n```text hideCopy\n-[ RECORD 1 ]-------------------------------------\nid          | f9f176eb-7069-4743-9403-582c04354ffc\nstatus      | valid\ncreated     | 2022-08-18 22:31:50.331792\nexpires     |\nkey_type    | aead-det\nkey_id      | 2\nkey_context | \\x7067736f6469756d\ncomment     | This is the comment for the new key\nuser_data   |\n```\n\nNow you can encrypt table secrets with this new key by inserting its ID explicitly:\n\n```sql\ninsert into vault.secrets\n  (secret, associated, key_id)\nvalues (\n  'apikey_XaYrurzcquqhEdBjzfTzfwAZqpd',\n  'This is some different associated data.',\n  'f9f176eb-7069-4743-9403-582c04354ffc'\n)\nreturning *;\n```\n\n```text hideCopy\n-[ RECORD 1 ]------------------------------------------------------------\nid         | 9c58a0f3-aa40-4789-b683-6db48b241f9e\nsecret     | YWxuTnWdF55MuRrZ7xneBvaz2uH59U1dJV/7CCZjSn5B5jELOoy/csq8x/s=\nkey_id     | f9f176eb-7069-4743-9403-582c04354ffc\nassociated | This is some different associated data.\nnonce      | \\xd39808b07c9ae52c8f02c33a7f87595c\ncreated_at | 2022-08-18 22:34:07.219941+00\n```\n\nThe type of encryption used by the Vault is called [Authenticated Encryption with Associated Data](https://en.wikipedia.org/wiki/Authenticated_encryption).\nThe data you insert into the `associated` column, which is up to you, is combined with the encrypted text when libsodium creates the authentication signature for the secret.\nThis means that when you read the secret, you know that the associated data is also authentic. The associated data could be an account ID or some\ninformation that ties your system to the secret. And as always, you can refer to rows in the secrets table by their primary key UUID.\n\nIf you only want to store secrets that you know are encrypted on disk and in backups, then all you need to know is shown above. Just insert secrets into the table,\noptionally creating new keys, and select them from the view when you want to use them.\n\n## Going Beyond the Vault\n\nThe Vault is good for a reasonable amount of secure data, like API keys, access tokens, or environment variables.\nBut if you have a lot more sensitive information, like personally Identifiable Information (PII),\nyou may want to break them out into side-tables using pgsodium's\n[Transparent Column Encryption](https://github.com/michelp/pgsodium#transparent-column-encryption) which we will describe soon in a follow-up blog post. Stay tuned!\n","title":"Supabase Vault","description":"Today we're announcing Vault, a Postgres extension for managing secrets and encryption inside your database.","author":"michel","image":"lw5-vault/supabase-vault.jpg","thumb":"lw5-vault/supabase-vault.jpg","tags":["launch-week"],"date":"2022-08-19","toc_depth":2,"toc":{"json":[{"content":"Background","slug":"background","lvl":2,"i":0,"seen":0},{"content":"Problems with raw keys","slug":"problems-with-raw-keys","lvl":3,"i":1,"seen":0},{"content":"Supabase Vault","slug":"supabase-vault","lvl":2,"i":2,"seen":0},{"content":"Going Beyond the Vault","slug":"going-beyond-the-vault","lvl":2,"i":3,"seen":0}],"highest":2,"tokens":[{"type":"paragraph_open","tight":false,"lines":[1,3],"level":0},{"type":"inline","content":"Today we're announcing [Supabase Vault](https://github.com/supabase/vault), a Postgres extension for managing secrets and encryption inside your database.\nVault is a thin usability-layer on top of [pgsodium](https://github.com/michelp/pgsodium).","level":1,"lines":[1,3],"children":[{"type":"text","content":"Today we're announcing ","level":0},{"type":"link_open","href":"https://github.com/supabase/vault","title":"","level":0},{"type":"text","content":"Supabase Vault","level":1},{"type":"link_close","level":0},{"type":"text","content":", a Postgres extension for managing secrets and encryption inside your database.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"Vault is a thin usability-layer on top of ","level":0},{"type":"link_open","href":"https://github.com/michelp/pgsodium","title":"","level":0},{"type":"text","content":"pgsodium","level":1},{"type":"link_close","level":0},{"type":"text","content":".","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"paragraph_open","tight":false,"lines":[4,6],"level":0},{"type":"inline","content":"Vault is not available on the Supabase platform yet. We're finalizing usability and security testing.\nThis release is intended to gather user-feedback from our community and customers.","level":1,"lines":[4,6],"children":[{"type":"text","content":"Vault is not available on the Supabase platform yet. We're finalizing usability and security testing.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"This release is intended to gather user-feedback from our community and customers.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"paragraph_open","tight":false,"lines":[7,9],"level":0},{"type":"inline","content":"Soon, we'll release a blog post that describes more about the technology behind Vault - [libsodium](https://doc.libsodium.org/) and\n[pgsodium](https://doc.libsodium.org/). For now, we will go through a quick example of storing a secret, like a service access token, into the Vault.","level":1,"lines":[7,9],"children":[{"type":"text","content":"Soon, we'll release a blog post that describes more about the technology behind Vault - ","level":0},{"type":"link_open","href":"https://doc.libsodium.org/","title":"","level":0},{"type":"text","content":"libsodium","level":1},{"type":"link_close","level":0},{"type":"text","content":" and","level":0},{"type":"softbreak","level":0},{"type":"link_open","href":"https://doc.libsodium.org/","title":"","level":0},{"type":"text","content":"pgsodium","level":1},{"type":"link_close","level":0},{"type":"text","content":". For now, we will go through a quick example of storing a secret, like a service access token, into the Vault.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"heading_open","hLevel":2,"lines":[10,11],"level":0},{"type":"inline","content":"[Background](#background)","level":1,"lines":[10,11],"children":[{"type":"text","content":"Background","level":0}],"lvl":2,"i":0,"seen":0,"slug":"background"},{"type":"heading_close","hLevel":2,"level":0},{"type":"paragraph_open","tight":false,"lines":[12,16],"level":0},{"type":"inline","content":"Until now, the industry-standard for PostgreSQL encryption is a built-in extension called [`pgcrypto`](https://www.postgresql.org/docs/current/pgcrypto.html).\nLike most cloud providers, Supabase offers `pgcrypto` for developers to use in their applications. `pgcrypto` has been around for a long time,\nand while it supports some basic encryption and decryption abilities, it lacks features like public key signing, key derivation APIs, streaming encryption,\nand other modern features required by security-first applications.","level":1,"lines":[12,16],"children":[{"type":"text","content":"Until now, the industry-standard for PostgreSQL encryption is a built-in extension called ","level":0},{"type":"link_open","href":"https://www.postgresql.org/docs/current/pgcrypto.html","title":"","level":0},{"type":"code","content":"pgcrypto","block":false,"level":1},{"type":"link_close","level":0},{"type":"text","content":".","level":0},{"type":"softbreak","level":0},{"type":"text","content":"Like most cloud providers, Supabase offers ","level":0},{"type":"code","content":"pgcrypto","block":false,"level":0},{"type":"text","content":" for developers to use in their applications. ","level":0},{"type":"code","content":"pgcrypto","block":false,"level":0},{"type":"text","content":" has been around for a long time,","level":0},{"type":"softbreak","level":0},{"type":"text","content":"and while it supports some basic encryption and decryption abilities, it lacks features like public key signing, key derivation APIs, streaming encryption,","level":0},{"type":"softbreak","level":0},{"type":"text","content":"and other modern features required by security-first applications.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"heading_open","hLevel":3,"lines":[17,18],"level":0},{"type":"inline","content":"[Problems with raw keys](#problems-with-raw-keys)","level":1,"lines":[17,18],"children":[{"type":"text","content":"Problems with raw keys","level":0}],"lvl":3,"i":1,"seen":0,"slug":"problems-with-raw-keys"},{"type":"heading_close","hLevel":3,"level":0},{"type":"paragraph_open","tight":false,"lines":[19,21],"level":0},{"type":"inline","content":"Databases often store sensitive information, and they need tools that guarantee this data is stored and backed-up in an encrypted form.\nA fundamental issue with `pgcrypto` is that it lacks the ability to derive keys from outside of SQL. Instead you must have the raw encryption key for the algorithm you wish to use:","level":1,"lines":[19,21],"children":[{"type":"text","content":"Databases often store sensitive information, and they need tools that guarantee this data is stored and backed-up in an encrypted form.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"A fundamental issue with ","level":0},{"type":"code","content":"pgcrypto","block":false,"level":0},{"type":"text","content":" is that it lacks the ability to derive keys from outside of SQL. Instead you must have the raw encryption key for the algorithm you wish to use:","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"fence","params":"sql","content":"create extension pgcrypto;\n\ncreate table users (\n  id serial primary key,\n  email varchar not null unique\n);\n\ninsert into users\n  (email)\nvalues\n  (pgp_sym_encrypt('alice@supabase.io', 's3kr3t_k3y')),\n  (pgp_sym_encrypt('bob@supabase.io', 's3kr3t_key'));\n","lines":[22,36],"level":0},{"type":"paragraph_open","tight":false,"lines":[37,40],"level":0},{"type":"inline","content":"pgcrypto works with _raw_ keys. In order to encrypt the data with pgcrypto you must pass the key directly to the encryption function.\nLeaking those raw keys is all too easy - logs, files, clients, tables, replication streams - you name it.\nWouldn't it be great if you could encrypt data, but instead of specifying the raw key you reference it indirectly, like with a key ID?","level":1,"lines":[37,40],"children":[{"type":"text","content":"pgcrypto works with ","level":0},{"type":"em_open","level":0},{"type":"text","content":"raw","level":1},{"type":"em_close","level":0},{"type":"text","content":" keys. In order to encrypt the data with pgcrypto you must pass the key directly to the encryption function.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"Leaking those raw keys is all too easy - logs, files, clients, tables, replication streams - you name it.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"Wouldn't it be great if you could encrypt data, but instead of specifying the raw key you reference it indirectly, like with a key ID?","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"heading_open","hLevel":2,"lines":[41,42],"level":0},{"type":"inline","content":"[Supabase Vault](#supabase-vault)","level":1,"lines":[41,42],"children":[{"type":"text","content":"Supabase Vault","level":0}],"lvl":2,"i":2,"seen":0,"slug":"supabase-vault"},{"type":"heading_close","hLevel":2,"level":0},{"type":"paragraph_open","tight":false,"lines":[43,44],"level":0},{"type":"inline","content":"Supabase Vault allows you to store secrets without leaking any sensitive information.","level":1,"lines":[43,44],"children":[{"type":"text","content":"Supabase Vault allows you to store secrets without leaking any sensitive information.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"paragraph_open","tight":false,"lines":[45,47],"level":0},{"type":"inline","content":"The Vault is a good place to put things like API keys, access tokens, and other secrets from external services that you need to access within your database.\nThe core of the Supabase Vault is a table with some metadata and an encrypted text column where you can put your secrets and any metadata related to them.","level":1,"lines":[45,47],"children":[{"type":"text","content":"The Vault is a good place to put things like API keys, access tokens, and other secrets from external services that you need to access within your database.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"The core of the Supabase Vault is a table with some metadata and an encrypted text column where you can put your secrets and any metadata related to them.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"paragraph_open","tight":false,"lines":[48,51],"level":0},{"type":"inline","content":"We take the pain out of key management by pre-generating a unique, per-database key that is used by default - a “root” key - which is stored outside of the SQL language,\naccessibly only internally in the Postgres server by the libsodium library. This root key is managed by the [pgsodium](https://github.com/michelp/pgsodium) Postgres extension\nwhen the server boots using [Server Key Management.](https://github.com/michelp/pgsodium#server-key-management)","level":1,"lines":[48,51],"children":[{"type":"text","content":"We take the pain out of key management by pre-generating a unique, per-database key that is used by default - a “root” key - which is stored outside of the SQL language,","level":0},{"type":"softbreak","level":0},{"type":"text","content":"accessibly only internally in the Postgres server by the libsodium library. This root key is managed by the ","level":0},{"type":"link_open","href":"https://github.com/michelp/pgsodium","title":"","level":0},{"type":"text","content":"pgsodium","level":1},{"type":"link_close","level":0},{"type":"text","content":" Postgres extension","level":0},{"type":"softbreak","level":0},{"type":"text","content":"when the server boots using ","level":0},{"type":"link_open","href":"https://github.com/michelp/pgsodium#server-key-management","title":"","level":0},{"type":"text","content":"Server Key Management.","level":1},{"type":"link_close","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"paragraph_open","tight":false,"lines":[52,55],"level":0},{"type":"inline","content":"pgsodium provides an Encryption and Key Derivation API based on the [libsodium library](https://libsodium.gitbook.io/doc/) and can get it's root key from a\nvariety of sources depending on how you configure it. Supabase generates and preserves your project's root key behind the scenes, so you don't have to worry about it.\nIf you install pgsodium locally the default is to generate a random root key from the `/dev/urandom` device which is then saved in a file in your Postgres data directory.","level":1,"lines":[52,55],"children":[{"type":"text","content":"pgsodium provides an Encryption and Key Derivation API based on the ","level":0},{"type":"link_open","href":"https://libsodium.gitbook.io/doc/","title":"","level":0},{"type":"text","content":"libsodium library","level":1},{"type":"link_close","level":0},{"type":"text","content":" and can get it's root key from a","level":0},{"type":"softbreak","level":0},{"type":"text","content":"variety of sources depending on how you configure it. Supabase generates and preserves your project's root key behind the scenes, so you don't have to worry about it.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"If you install pgsodium locally the default is to generate a random root key from the ","level":0},{"type":"code","content":"/dev/urandom","block":false,"level":0},{"type":"text","content":" device which is then saved in a file in your Postgres data directory.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"paragraph_open","tight":false,"lines":[56,57],"level":0},{"type":"inline","content":"Installing the `vault` extension is the same as any other Postgres extension:","level":1,"lines":[56,57],"children":[{"type":"text","content":"Installing the ","level":0},{"type":"code","content":"vault","block":false,"level":0},{"type":"text","content":" extension is the same as any other Postgres extension:","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"fence","params":"sql","content":"create extension vault with schema vault;\n","lines":[58,61],"level":0},{"type":"paragraph_open","tight":false,"lines":[62,63],"level":0},{"type":"inline","content":"Once enabled, you can insert secrets into the `vault.secrets` table:","level":1,"lines":[62,63],"children":[{"type":"text","content":"Once enabled, you can insert secrets into the ","level":0},{"type":"code","content":"vault.secrets","block":false,"level":0},{"type":"text","content":" table:","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"fence","params":"sql","content":"insert into vault.secrets\n  (secret, associated)\nvalues\n  ('s3kr3t_k3y', 'This is the secret API service key.');\n","lines":[64,70],"level":0},{"type":"paragraph_open","tight":false,"lines":[71,72],"level":0},{"type":"inline","content":"Now when you look in the `vault.secrets` table, the secret is encrypted:","level":1,"lines":[71,72],"children":[{"type":"text","content":"Now when you look in the ","level":0},{"type":"code","content":"vault.secrets","block":false,"level":0},{"type":"text","content":" table, the secret is encrypted:","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"fence","params":"sql","content":"select * from vault.secrets;\n","lines":[73,76],"level":0},{"type":"fence","params":"text hideCopy","content":"-[ RECORD 1 ]--------------------------------------------------------\nid         | f6a2fe0a-3471-4eea-a581-75c4d2be396b\nsecret     | /eT9bb96POTJ7L2gYrluTZ3r3pG5IMwPSQo6pQP0xdZTarpRrpWPXTWQ\nkey_id     | caabfc28-2ab3-48f5-8978-1b3d4b659911\nassociated | This is the secret API service key.\nnonce      | \\x77c7381c523630ba72f1f137626a9f9a\ncreated_at | 2022-08-18 19:33:15.312651+00\n","lines":[77,86],"level":0},{"type":"paragraph_open","tight":false,"lines":[87,89],"level":0},{"type":"inline","content":"Notice how the row has a `key_id` column. This is the _ID_ of the internally derived key that is used to encrypt the secret, not the key itself.\nThe actual raw key is not available to you in SQL, it is managed entirely outside of the SQL language in the Postgres server.","level":1,"lines":[87,89],"children":[{"type":"text","content":"Notice how the row has a ","level":0},{"type":"code","content":"key_id","block":false,"level":0},{"type":"text","content":" column. This is the ","level":0},{"type":"em_open","level":0},{"type":"text","content":"ID","level":1},{"type":"em_close","level":0},{"type":"text","content":" of the internally derived key that is used to encrypt the secret, not the key itself.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"The actual raw key is not available to you in SQL, it is managed entirely outside of the SQL language in the Postgres server.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"paragraph_open","tight":false,"lines":[90,92],"level":0},{"type":"inline","content":"At Supabase, we manage this key for your project automatically and generate a unique default Key ID for you in the `secrets` table.\nFor self-hosting, pgsodium [supports a variety of ways](https://github.com/michelp/pgsodium#server-key-management) to place the root key into Postgres.","level":1,"lines":[90,92],"children":[{"type":"text","content":"At Supabase, we manage this key for your project automatically and generate a unique default Key ID for you in the ","level":0},{"type":"code","content":"secrets","block":false,"level":0},{"type":"text","content":" table.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"For self-hosting, pgsodium ","level":0},{"type":"link_open","href":"https://github.com/michelp/pgsodium#server-key-management","title":"","level":0},{"type":"text","content":"supports a variety of ways","level":1},{"type":"link_close","level":0},{"type":"text","content":" to place the root key into Postgres.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"paragraph_open","tight":false,"lines":[93,94],"level":0},{"type":"inline","content":"To see the decrypted data, there is a special view created called `vault.decrypted_secrets`:","level":1,"lines":[93,94],"children":[{"type":"text","content":"To see the decrypted data, there is a special view created called ","level":0},{"type":"code","content":"vault.decrypted_secrets","block":false,"level":0},{"type":"text","content":":","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"fence","params":"sql","content":"select * from vault.decrypted_secrets;\n","lines":[95,98],"level":0},{"type":"fence","params":"text hideCopy","content":"-[ RECORD 1 ]----+---------------------------------------------------------\nid               | f6a2fe0a-3471-4eea-a581-75c4d2be396b\nsecret           | /eT9bb96POTJ7L2gYrluTZ3r3pG5IMwPSQo6pQP0xdZTarpRrpWPXTWQ\ndecrypted_secret | s3kr3t_k3y\nkey_id           | caabfc28-2ab3-48f5-8978-1b3d4b659911\nassociated       | This is the secret API service key.\nnonce            | \\x77c7381c523630ba72f1f137626a9f9a\ncreated_at       | 2022-08-18 19:33:15.312651+00\n","lines":[99,109],"level":0},{"type":"paragraph_open","tight":false,"lines":[110,113],"level":0},{"type":"inline","content":"Now you can see a new `decrypted_secret` column that contains the decrypted secret we originally inserted into the table.\nThis `vault.decrypted_secrets` view automatically decrypts rows in the `vault.secrets` table “on-the-fly” as you query them, but the secret is stored on disk in _encrypted_ form.\nIf you take a backup, or pause your project, that data remains encrypted. We will keep your hidden root key safe in our backend systems for when you need to restore or un-pause your projects.","level":1,"lines":[110,113],"children":[{"type":"text","content":"Now you can see a new ","level":0},{"type":"code","content":"decrypted_secret","block":false,"level":0},{"type":"text","content":" column that contains the decrypted secret we originally inserted into the table.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"This ","level":0},{"type":"code","content":"vault.decrypted_secrets","block":false,"level":0},{"type":"text","content":" view automatically decrypts rows in the ","level":0},{"type":"code","content":"vault.secrets","block":false,"level":0},{"type":"text","content":" table “on-the-fly” as you query them, but the secret is stored on disk in ","level":0},{"type":"em_open","level":0},{"type":"text","content":"encrypted","level":1},{"type":"em_close","level":0},{"type":"text","content":" form.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"If you take a backup, or pause your project, that data remains encrypted. We will keep your hidden root key safe in our backend systems for when you need to restore or un-pause your projects.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"paragraph_open","tight":false,"lines":[114,115],"level":0},{"type":"inline","content":"If you wish to use your own Key ID for different secrets, instead of the default Key ID we've generated, you can create one using the `pgsodium.create_key()` function:","level":1,"lines":[114,115],"children":[{"type":"text","content":"If you wish to use your own Key ID for different secrets, instead of the default Key ID we've generated, you can create one using the ","level":0},{"type":"code","content":"pgsodium.create_key()","block":false,"level":0},{"type":"text","content":" function:","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"fence","params":"sql","content":"select * from pgsodium.create_key('This is a comment for the new key');\n","lines":[116,119],"level":0},{"type":"fence","params":"text hideCopy","content":"-[ RECORD 1 ]-------------------------------------\nid          | f9f176eb-7069-4743-9403-582c04354ffc\nstatus      | valid\ncreated     | 2022-08-18 22:31:50.331792\nexpires     |\nkey_type    | aead-det\nkey_id      | 2\nkey_context | \\x7067736f6469756d\ncomment     | This is the comment for the new key\nuser_data   |\n","lines":[120,132],"level":0},{"type":"paragraph_open","tight":false,"lines":[133,134],"level":0},{"type":"inline","content":"Now you can encrypt table secrets with this new key by inserting its ID explicitly:","level":1,"lines":[133,134],"children":[{"type":"text","content":"Now you can encrypt table secrets with this new key by inserting its ID explicitly:","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"fence","params":"sql","content":"insert into vault.secrets\n  (secret, associated, key_id)\nvalues (\n  'apikey_XaYrurzcquqhEdBjzfTzfwAZqpd',\n  'This is some different associated data.',\n  'f9f176eb-7069-4743-9403-582c04354ffc'\n)\nreturning *;\n","lines":[135,145],"level":0},{"type":"fence","params":"text hideCopy","content":"-[ RECORD 1 ]------------------------------------------------------------\nid         | 9c58a0f3-aa40-4789-b683-6db48b241f9e\nsecret     | YWxuTnWdF55MuRrZ7xneBvaz2uH59U1dJV/7CCZjSn5B5jELOoy/csq8x/s=\nkey_id     | f9f176eb-7069-4743-9403-582c04354ffc\nassociated | This is some different associated data.\nnonce      | \\xd39808b07c9ae52c8f02c33a7f87595c\ncreated_at | 2022-08-18 22:34:07.219941+00\n","lines":[146,155],"level":0},{"type":"paragraph_open","tight":false,"lines":[156,160],"level":0},{"type":"inline","content":"The type of encryption used by the Vault is called [Authenticated Encryption with Associated Data](https://en.wikipedia.org/wiki/Authenticated_encryption).\nThe data you insert into the `associated` column, which is up to you, is combined with the encrypted text when libsodium creates the authentication signature for the secret.\nThis means that when you read the secret, you know that the associated data is also authentic. The associated data could be an account ID or some\ninformation that ties your system to the secret. And as always, you can refer to rows in the secrets table by their primary key UUID.","level":1,"lines":[156,160],"children":[{"type":"text","content":"The type of encryption used by the Vault is called ","level":0},{"type":"link_open","href":"https://en.wikipedia.org/wiki/Authenticated_encryption","title":"","level":0},{"type":"text","content":"Authenticated Encryption with Associated Data","level":1},{"type":"link_close","level":0},{"type":"text","content":".","level":0},{"type":"softbreak","level":0},{"type":"text","content":"The data you insert into the ","level":0},{"type":"code","content":"associated","block":false,"level":0},{"type":"text","content":" column, which is up to you, is combined with the encrypted text when libsodium creates the authentication signature for the secret.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"This means that when you read the secret, you know that the associated data is also authentic. The associated data could be an account ID or some","level":0},{"type":"softbreak","level":0},{"type":"text","content":"information that ties your system to the secret. And as always, you can refer to rows in the secrets table by their primary key UUID.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"paragraph_open","tight":false,"lines":[161,163],"level":0},{"type":"inline","content":"If you only want to store secrets that you know are encrypted on disk and in backups, then all you need to know is shown above. Just insert secrets into the table,\noptionally creating new keys, and select them from the view when you want to use them.","level":1,"lines":[161,163],"children":[{"type":"text","content":"If you only want to store secrets that you know are encrypted on disk and in backups, then all you need to know is shown above. Just insert secrets into the table,","level":0},{"type":"softbreak","level":0},{"type":"text","content":"optionally creating new keys, and select them from the view when you want to use them.","level":0}]},{"type":"paragraph_close","tight":false,"level":0},{"type":"heading_open","hLevel":2,"lines":[164,165],"level":0},{"type":"inline","content":"[Going Beyond the Vault](#going-beyond-the-vault)","level":1,"lines":[164,165],"children":[{"type":"text","content":"Going Beyond the Vault","level":0}],"lvl":2,"i":3,"seen":0,"slug":"going-beyond-the-vault"},{"type":"heading_close","hLevel":2,"level":0},{"type":"paragraph_open","tight":false,"lines":[166,170],"level":0},{"type":"inline","content":"The Vault is good for a reasonable amount of secure data, like API keys, access tokens, or environment variables.\nBut if you have a lot more sensitive information, like personally Identifiable Information (PII),\nyou may want to break them out into side-tables using pgsodium's\n[Transparent Column Encryption](https://github.com/michelp/pgsodium#transparent-column-encryption) which we will describe soon in a follow-up blog post. Stay tuned!","level":1,"lines":[166,170],"children":[{"type":"text","content":"The Vault is good for a reasonable amount of secure data, like API keys, access tokens, or environment variables.","level":0},{"type":"softbreak","level":0},{"type":"text","content":"But if you have a lot more sensitive information, like personally Identifiable Information (PII),","level":0},{"type":"softbreak","level":0},{"type":"text","content":"you may want to break them out into side-tables using pgsodium's","level":0},{"type":"softbreak","level":0},{"type":"link_open","href":"https://github.com/michelp/pgsodium#transparent-column-encryption","title":"","level":0},{"type":"text","content":"Transparent Column Encryption","level":1},{"type":"link_close","level":0},{"type":"text","content":" which we will describe soon in a follow-up blog post. Stay tuned!","level":0}]},{"type":"paragraph_close","tight":false,"level":0}],"content":"- [Background](#background)\n- [Supabase Vault](#supabase-vault)\n- [Going Beyond the Vault](#going-beyond-the-vault)"}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"supabase-vault"},"buildId":"E3qX-eNJiFQeVyt1la8Oh","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>